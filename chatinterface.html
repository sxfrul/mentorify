<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat with Mentorify</title>
    <link rel="stylesheet" href="mentorify.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-content">
            <div class="chat-messages" id="chatMessages"></div>
            <form class="chat-input" id="chatForm">
                <a class="chat-input-icon1">+</a>
                <input type="text" id="prompt" placeholder="Message Mentorify" />
                <button type="submit" class="chat-input-icon2">âž¤</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById("chatForm").addEventListener("submit", async function (e) {
            e.preventDefault(); // Prevent form refresh

            const messageInput = document.getElementById("prompt");
            const messageText = messageInput.value.trim();

            if (messageText) {
                // Add user message
                const userMessageElement = document.createElement("div");
                userMessageElement.className = "chat-message user";
                userMessageElement.textContent = messageText;

                document.getElementById("chatMessages").appendChild(userMessageElement);
                messageInput.value = ""; // Clear input

                // Fetch AI response
                try {
                    const response = await fetch("http://127.0.0.1:5000/chat", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "llama3.2", // Ensure this is the correct model name
                            messages: [{ role: "user", content: messageText }],
                        }),
                    });

                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }

                    const data = await response.json();

                    // Add bot response after a short delay
                    setTimeout(() => {
                        const botMessageElement = document.createElement("div");
                        botMessageElement.className = "chat-message bot";
                        botMessageElement.textContent = data.message;

                        document.getElementById("chatMessages").appendChild(botMessageElement);

                        // Scroll to the latest message
                        const chatMessages = document.getElementById("chatMessages");
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 500);

                } catch (error) {
                    console.error("Error fetching AI response:", error);
                }
            }
        });
    </script>
</body>
</html>
