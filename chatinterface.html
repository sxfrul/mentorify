<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat with Mentorify</title>
    <link rel="stylesheet" href="mentorify.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-content">
            <div class="chat-messages" id="chatMessages"></div>
            <form class="chat-input" id="chatForm">
                <a class="chat-input-icon1">+</a>
                <input type="text" id="prompt" placeholder="Message Mentorify" />
                <button type="submit" class="chat-input-icon2">âž¤</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById("chatForm").addEventListener("submit", function (e) {
            e.preventDefault(); // Prevent form refresh

            const messageInput = document.getElementById("prompt");
            const messageText = messageInput.value.trim();

            if (messageText) {
                // Add user message to the chat
                const userMessageElement = document.createElement("div");
                userMessageElement.className = "chat-message user";
                userMessageElement.textContent = messageText;

                document.getElementById("chatMessages").appendChild(userMessageElement);
                messageInput.value = ""; // Clear input field

                // Create a placeholder for the bot's response
                const botMessageElement = document.createElement("div");
                botMessageElement.className = "chat-message bot";
                botMessageElement.textContent = "Typing..."; // Initial placeholder
                document.getElementById("chatMessages").appendChild(botMessageElement);

                // Use EventSource for streaming response
                const eventSource = new EventSource(`http://127.0.0.1:5000/stream_chat?message=${encodeURIComponent(messageText)}`);

                eventSource.onmessage = function (event) {
                    const data = JSON.parse(event.data);
                    if (data.message) {
                        // Update the same bot message element with chunks
                        botMessageElement.textContent += data.message;

                        // Scroll to the latest message
                        const chatMessages = document.getElementById("chatMessages");
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } else if (data.error) {
                        console.error("Error from server:", data.error);
                        botMessageElement.textContent = "Error receiving response.";
                        eventSource.close(); // Close the connection on error
                    }
                };

                eventSource.onerror = function (err) {
                    console.error("EventSource failed:", err);
                    botMessageElement.textContent = "Connection lost. Please try again.";
                    eventSource.close(); // Close the connection on error
                };
            }
        });
    </script>
</body>
</html>
